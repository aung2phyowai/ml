"""=============================================================================
Randomized matrix inversion using randomized SVD.
============================================================================="""

from   ml import linalg as LA
import numpy as np

# ------------------------------------------------------------------------------

mm = np.matmul

# ------------------------------------------------------------------------------

def rinv(M, k=100):
    U, Σ, Vh = LA.rsvd(M, k)
    inds = Σ != 0
    Σ[inds] = 1 / Σ
    M_inv = mm(Vh[:2 * k].T, mm(np.diag(Σ), U.T))
    return M_inv
